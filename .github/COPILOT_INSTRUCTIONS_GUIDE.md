# 📖 .github/copilot-instructions.md 使用指南

## 📌 文件作用

`.github/copilot-instructions.md` 是为 GitHub Copilot、Claude、Cursor 等 AI 代码助手提供的 **项目知识库**。该文件帮助 AI 代理快速理解项目架构、约定和最佳实践，从而生成更准确、更符合项目风格的代码。

---

## 🎯 核心内容总结

该文件包含以下几个关键部分：

### 1️⃣ **项目概览**
- 技术栈: React 19 + Cloudflare Workers + D1 SQLite + Google Gemini
- 架构特点: 全栈 Serverless

### 2️⃣ **核心架构**
- 文件结构与责任划分
- 数据流模式（前端 → 认证服务 → Worker API → 数据库）

### 3️⃣ **认证系统详解**
- 密码登录流程
- 邮箱验证码登录流程（两步：发送验证码 → 校验并登录）

### 4️⃣ **数据库规范**
- Teacher 表结构
- EmailLoginCode 表结构（邮箱验证码）
- 重要约定：密码和验证码都存储哈希值、使用 ISO 8601 时间戳

### 5️⃣ **开发工作流**
- 本地启动命令
- API 调试方式（PowerShell 示例）
- 部署流程

### 6️⃣ **常见编码模式**
- 如何添加新 API 端点
- 前端服务调用模式
- React 组件中的认证检查

### 7️⃣ **项目特定约定**
- 命名规范（API、接口、组件、变量、数据库）
- API 响应格式统一
- 类型定义位置

### 8️⃣ **调试技巧与常见错误**

---

## 🚀 如何使用

### 场景 1: 向 Copilot 请求新功能

**效果**：AI 会自动遵循项目约定，生成风格一致的代码

**示例请求**：
```
我需要添加"修改密码"功能：
- 后端 API: POST /api/auth/change-password
- 要求用户输入旧密码和新密码
- 返回 { success: true } 或 { success: false, error: "..." }
- 参考邮箱验证码登录的实现模式
```

**AI 会参考文件中的**:
- API 响应格式统一约定
- worker.ts 中的路由模式
- 密码哈希方式 (SHA-256)
- 错误处理方式

### 场景 2: 理解现有代码结构

**问题**: "这个项目的登录流程是怎样的？"

**AI 会参考文件中的**:
- 认证系统详解部分
- 关键文件速查表
- 数据流模式图

### 场景 3: 修复 Bug

**问题**: "为什么验证码登录总是返回 'Email not registered'？"

**AI 会参考文件中的**:
- EmailLoginCode 表结构
- Teacher 表结构
- 常见错误与解决方案
- 调试技巧

### 场景 4: 扩展功能

**问题**: "我想集成真实的邮件服务（SendGrid），应该怎么改？"

**AI 会参考文件中的**:
- 扩展功能建议部分
- 邮件服务集成说明
- sendVerificationEmail() 函数位置

---

## 📋 文件结构检查清单

| 部分 | 行号 | 用途 |
|------|------|------|
| 项目概览 | 3-11 | 快速了解项目 |
| 核心架构 | 13-50 | 理解代码组织 |
| 认证系统 | 52-96 | 学习登录流程 |
| 数据库规范 | 98-115 | 数据库操作指南 |
| 开发工作流 | 117-155 | 本地开发和部署 |
| 编码模式 | 157-220 | 参考实现方式 |
| 项目约定 | 222-270 | 命名和风格规范 |
| 扩展功能 | 272-295 | 未来开发方向 |
| 调试技巧 | 297-330 | 问题排查方法 |
| 文件速查 | 332-345 | 快速定位代码 |

---

## ✅ 如何维护这个文件

### 何时需要更新

1. **添加新的 API 端点时**
   - 在"常见编码模式"中更新示例
   - 在"关键文件速查"中添加行号

2. **修改命名规范或约定时**
   - 更新"项目特定的约定"部分
   - 确保所有示例代码符合新约定

3. **发现新的常见错误时**
   - 添加到"常见错误与解决"表格

4. **引入新技术或库时**
   - 更新"项目概览"中的技术栈
   - 添加相应的使用说明

### 最佳实践

- **保持简洁**: 避免冗长的说明，用表格和示例代码代替
- **实时例子**: 所有代码示例都应该是真实存在的，避免假设代码
- **定期审查**: 每个季度检查一次，确保内容仍然准确
- **版本控制**: 将更新与 Git commit 关联，便于追踪

---

## 🔗 相关文件参考

项目中其他有用的文档：

| 文件 | 用途 |
|------|------|
| `README.md` | 项目总体说明和快速开始 |
| `file/Email_Code_Integration_Guide.md` | 邮箱验证码集成详细指南 |
| `file/Implementation_Status.md` | 功能实现状态跟踪 |
| `file/Teacher_Email_Verification_Login.md` | 邮箱验证码功能设计文档 |
| `schema.sql` | 数据库表定义（数据库真实来源） |
| `types.ts` | TypeScript 类型定义（类型真实来源） |

---

## 💡 使用建议

### 对于开发者

1. **第一次使用项目**: 先读 README.md，再读本文件的"核心架构"部分
2. **添加新功能**: 查看"常见编码模式"，参考类似功能的实现
3. **遇到问题**: 先看"常见错误与解决"表格，再看"调试技巧"

### 对于 AI 代理

此文件已针对 AI 代理优化，包含：
- ✅ 明确的架构描述
- ✅ 真实代码示例（非伪代码）
- ✅ 约定和规范的完整列表
- ✅ 关键文件的位置和行号
- ✅ 常见问题和解决方案

在向 AI 请求功能时，你可以：
- 直接参考文件中的行号和文件位置
- 使用文件中的约定名称（如 API 路由格式）
- 参考类似功能的实现（文件速查表）

---

## 📊 文件维护历史

| 日期 | 更新内容 | 维护者 |
|------|---------|--------|
| 2026-01-28 | 初始创建，包含邮箱验证码登录完整文档 | AI Copilot |

---

## ❓ 常见问题

**Q: 为什么要有这个文件？**
A: 帮助 AI 代理快速理解项目，生成符合项目风格和约定的代码。

**Q: 我应该多久更新一次？**
A: 每当项目的主要架构、约定或工作流发生变化时。通常是季度更新。

**Q: 如果 AI 生成的代码与文件说明不符怎么办？**
A: 可以：
1. 检查文件中的说明是否准确
2. 向 AI 提供更具体的约束条件
3. 更新文件中的示例代码

**Q: 这个文件会影响 AI 的代码建议吗？**
A: 是的。许多 AI 代理（包括 GitHub Copilot、Cursor 等）会读取工作区中的 `.github/copilot-instructions.md` 并将其融入上下文。

---

**📌 需要反馈？** 
查看 `.github/copilot-instructions.md` 的内容有什么不清楚或需要补充的地方，请告诉我！
